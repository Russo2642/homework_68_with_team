{% extends 'base/base.html' %}
{% load django_bootstrap5 %}
{% block menu %}
{% if user_obj == request.user %}
<form action="{% url 'logout' %}" method="post">
    {% csrf_token %}
    <input style="width:100px" type="submit" class="btn btn-danger" value="Выйти">
</form>
{% endif %}
{% endblock %}
{% block content %}


<div class="container">

    <table id="user-table">
        <tbody>
        <tr>
            <td>
                {% if user_obj.avatar %}
                <img class="avatar" src="{{ user_obj.avatar.url }}" alt="user picture">
                {% else %}
                <img class="avatar" style="width:100px; height:100px"
                     src="../../../uploads/user_pic/default.jpg"
                     alt="user picture">
                {% endif %}
            </td>
        </tr>
        <tr>
            <td>Имя</td>
            <td>{{ user_obj.first_name }} {{ user_obj.last_name }}</td>
        </tr>
        <tr>
            <td>Телефон</td>
            <td>{{ user_obj.phone }}</td>
        </tr>
        <tr>
            <td>Электронная почта</td>
            <td>{{ user_obj.email }}</td>
        </tr>
        <tr>
            <td>
                {% if user_obj == request.user %}
                <a class="link-edit" href="{% url 'change' request.user.pk %}"
                   style="text-decoration:None; border-style:None;">Редактировать профиль</a>
                {% endif %}
            </td>
        </tr>
        </tbody>

    </table>

</div>

<main class="index">
    <div class="index-top">
        <h3>Мои резюме</h3>
        {% if user_obj == request.user %}
        <button><a href="{% url 'cv_create' %}" class="create-res" style="text-decoration:none; color:black;">Создать
            резюме</a></button>
        {% endif %}
    </div>
    {% for cv in user_obj.cv.all %}
    <div class="index-status">
        <span>
            <form action="{% url 'publishing' cv.pk %}" method="post"> {% csrf_token %}
            {% if cv.is_published %}
            <button class="index-stats-button" type="submit">Снять с публикации</button>
            {% else %}
            <button class="index-stats-button" type="submit">Опубликовать</button>
            {% endif %}
        </form>
        </span>
        <a href="{% url 'cv_detail' cv.pk %}">Посмотреть резюме</a>
    </div>
    <div class="index-card">
        <h3>{{ cv.title }}</h3>
        <p>Обновлено <span>{{ cv.updated_at }}</span></p>
        <div class="index-stats">
            <form action="{% url 'update_button' cv.pk %}" method="post"> {% csrf_token %}
                <button class="index-stats-button" type="submit">Поднять в поиске</button>
            </form>
        </div>
    </div>
    {% empty %}
    <h1><p>CVs not found</p></h1>
    {% endfor %}
</main>


<div class="modal fade" id="editModal" tabindex="-1" aria-labelledby="editModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-sm">
        <div class="modal-content">
            <h5 class="modal-title">Редактирование профиля</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
            </button>
        </div>
        <form id="formEdit" action="">{% csrf_token %}
            <div class="modal-body">
                <div class="form-group validate">
                    <input type="image" name="avatar" class="form-control" placeholder="">
                    <small class="text-red text-muted mySpan"></small>
                </div>
                <div class="form-group validate">
                    <input type="text" name="first_name" class="form-control" placeholder="">
                    <small class="text-red text-muted mySpan"></small>
                </div>
                <div class="form-group validate">
                    <input type="text" name="last_name" class="form-control" placeholder="">
                    <small class="text-red text-muted mySpan"></small>
                </div>
                <div class="form-group validate">
                    <input type="text" name="email" class="form-control" placeholder="">
                    <small class="text-red text-muted mySpan"></small>
                </div>

                <div class="form-group validate">
                    <input type="text" name="phone" class="form-control" placeholder="">
                    <small class="text-red text-muted mySpan"></small>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Закрыть</button>
                <button type="submit" class="btn btn-success btbUpdate" data-dismiss="modal">Редактировать</button>
            </div>
        </form>
    </div>
</div>

{% endblock %}
<script src="https://code.jquery.com/jquery-3.6.1.js" integrity="sha256-3zlB5s2uwoUzrXK3BT7AX3FyvojsraNFxCc2vC/7pNI="crossorigin="anonymous"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.0/jquery.min.js"></script>
<script>
    $("#user-table tbody").on("click", ".link-edit", function(e){
        e.preventDefault();
        var $this = $(this);
        let avatar = $this.parents(".record").find('td').eq(0).text();
        let first_name = $this.parents(".record").find('td').eq(1).text();
        let last_name = $this.parents(".record").find('td').eq(1).text();
        let email= $this.parents(".record").find('td').eq(2).text();
        let phone = $this.parents(".record").find('td').eq(3).text();
        $("#formEdit input[name='avatar']").val(avatar);
        $("#formEdit input[name='first_name']").val(first_name);
        $("#formEdit input[name='last_name']").val(last_name);
        $("#formEdit input[name='email']").val(email);
        $("#formEdit input[name='phone']").val(phone);
        $("#editModal").modal("show");
        return false;
    });


</script>